%   CompileTemporalSubSamplesOfHMM.m
%   written by Anders Sejr Hansen (AndersSejrHansen@post.harvard.edu;
%   @Anders_S_Hansen; https://anderssejrhansen.wordpress.com)
%   License: GNU GPL v3
%   Dependent functions:
%       - TemporallyReSampleCellTracks.m
clear; clc; close all;
% add path for dependent functions:
addpath('Functions');

%   DESCRIPTION:
%   This script takes HMM-classified SPT data at high frame rates (223 Hz, 
%   133 Hz and 74 Hz) and then temporally sub-samples it to get data at
%   longer lag time. E.g. if you have data at 100 Hz and you take only the
%   data at odd frames (frame 1,3,5,7...) you end up getting data at 50 Hz.
%   One small concern when temporally subsampling is that when you
%   sub-sample to very long lag times (e.g. for data at 4.5 ms, 90 ms lag
%   time corresponds to frames 1,21,42,63,...) you end up with a slightly
%   biased set of trajectories, since the bound populations stays in focus
%   and gives long trajectories, whereas the free population largely
%   defocalizes. Thus, this could cause the HMM-classification to become
%   less robust and also means that slightly different trajectories could
%   be use for the different lag times.
%   To circumvent this, here we will reverse the order. First, the 223, 134
%   and 74 Hz data will be HMM-classified and then we will subsampled these
%   datasets. This should be more robust, although it will cost when it
%   comes to number of trajectories. The vbSPT-HMM cannot handle trajectory
%   gaps, so we will have to split into shorter trajectories, any
%   trajectory with gaps, which will cause us to have fewer very long
%   trajectories. 


TempSubSampleStruc = struct();
SavePath = './HMM_first_QC_data/';

% Define the temporal subsamples:

% 18-22.5 ms / 49 Hz
TempSubSampleStruc(1,1).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,1).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,1).TimePointsToUse{1,1} = 4;
TempSubSampleStruc(1,1).TimePointsToUse{1,2} = 3;
TempSubSampleStruc(1,1).TimePointsToUse{1,3} = [];
TempSubSampleStruc(1,1).SumSampleName = '44.4Hz';

% 27-31.5 ms (~34.2 Hz)
TempSubSampleStruc(1,2).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,2).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,2).TimePointsToUse{1,1} = [6,7];
TempSubSampleStruc(1,2).TimePointsToUse{1,2} = 4;
TempSubSampleStruc(1,2).TimePointsToUse{1,3} = 2;
TempSubSampleStruc(1,2).SumSampleName = '34.2Hz';

% 36-40.5 ms (~26 Hz)
TempSubSampleStruc(1,3).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,3).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,3).TimePointsToUse{1,1} = [8,9];
TempSubSampleStruc(1,3).TimePointsToUse{1,2} = 5;
TempSubSampleStruc(1,3).TimePointsToUse{1,3} = 3;
TempSubSampleStruc(1,3).SumSampleName = '26Hz';

% 45 ms (~22.2 Hz)
TempSubSampleStruc(1,4).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,4).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,4).TimePointsToUse{1,1} = [10];
TempSubSampleStruc(1,4).TimePointsToUse{1,2} = 6;
TempSubSampleStruc(1,4).TimePointsToUse{1,3} = [];
TempSubSampleStruc(1,4).SumSampleName = '22.2Hz';

% 52.5-54 ms (~18.8 Hz)
TempSubSampleStruc(1,5).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,5).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,5).TimePointsToUse{1,1} = [11,12];
TempSubSampleStruc(1,5).TimePointsToUse{1,2} = 7;
TempSubSampleStruc(1,5).TimePointsToUse{1,3} = 4;
TempSubSampleStruc(1,5).SumSampleName = '18.8Hz';

% 58.5-63 ms (~16.5 Hz)
TempSubSampleStruc(1,6).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,6).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,6).TimePointsToUse{1,1} = [13,14];
TempSubSampleStruc(1,6).TimePointsToUse{1,2} = 8;
TempSubSampleStruc(1,6).TimePointsToUse{1,3} = [];
TempSubSampleStruc(1,6).SumSampleName = '16.5Hz';

% 67.5 ms (~14.8 Hz)
TempSubSampleStruc(1,7).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,7).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,7).TimePointsToUse{1,1} = 15;
TempSubSampleStruc(1,7).TimePointsToUse{1,2} = 9;
TempSubSampleStruc(1,7).TimePointsToUse{1,3} = 5;
TempSubSampleStruc(1,7).SumSampleName = '14.8Hz';

% 81-82.5 ms (~12.2 Hz)
TempSubSampleStruc(1,8).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,8).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,8).TimePointsToUse{1,1} = [18,19];
TempSubSampleStruc(1,8).TimePointsToUse{1,2} = 11;
TempSubSampleStruc(1,8).TimePointsToUse{1,3} = 6;
TempSubSampleStruc(1,8).SumSampleName = '12.2Hz';

% 90-97.5 ms (~10.6 Hz)
TempSubSampleStruc(1,9).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,9).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,9).TimePointsToUse{1,1} = [21,22];
TempSubSampleStruc(1,9).TimePointsToUse{1,2} = [12,13];
TempSubSampleStruc(1,9).TimePointsToUse{1,3} = 7;
TempSubSampleStruc(1,9).SumSampleName = '10.6Hz';

% 105-112.5 ms (~9.2 Hz)
TempSubSampleStruc(1,10).TimePoints_conditions = {'223 Hz', '133 Hz', '74 Hz'};
TempSubSampleStruc(1,10).TimePointsToUse = cell(1,3);
TempSubSampleStruc(1,10).TimePointsToUse{1,1} = [23,24,25];
TempSubSampleStruc(1,10).TimePointsToUse{1,2} = [14,15];
TempSubSampleStruc(1,10).TimePointsToUse{1,3} = 8;
TempSubSampleStruc(1,10).SumSampleName = '9.2Hz';


% Compile sub-samples for all:
for DataSetIter = 40:41
    DataSet = DataSetIter;
    % Define the DataSets:
    if DataSet == 1
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_C59_Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                'mESC_C59_Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'mESC_C59_Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_C59_Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';

        
    elseif DataSet == 2
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_C87_Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                'mESC_C87_Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'mESC_C87_Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_C87_Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
    
    elseif DataSet == 3
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_wt-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_wt-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_wt-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_wt-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 4
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_11ZF-mut-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_11ZF-mut-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_11ZF-mut-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_11ZF-mut-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 5
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_ZF-del-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_ZF-del-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_ZF-del-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_ZF-del-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 6
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_H2B-Halo_223Hz_pooled_QC_CD2', ...
                                'mESC_H2B-Halo_133Hz_pooled_QC_CD2',...
                                'mESC_H2B-Halo_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_H2B-Halo_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
    
    elseif DataSet == 7
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_Halo-3xNLS_223Hz_pooled_QC_CD2', ...
                                'mESC_Halo-3xNLS_133Hz_pooled_QC_CD2',...
                                'mESC_Halo-3xNLS_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_Halo-3xNLS_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 8
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_C45_mRad21-Halo_G1_223Hz_pooled_QC_CD2', ...
                                'mESC_C45_mRad21-Halo_G1_133Hz_pooled_QC_CD2',...
                                'mESC_C45_mRad21-Halo_G1_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_C45_mRad21-Halo_G1_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 9
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_C45_mRad21-Halo_S-G2_223Hz_pooled_QC_CD2', ...
                                'mESC_C45_mRad21-Halo_S-G2_133Hz_pooled_QC_CD2',...
                                'mESC_C45_mRad21-Halo_S-G2_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_C45_mRad21-Halo_S-G2_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';    
        
    elseif DataSet == 10
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_wt-mRad21-Halo_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_wt-mRad21-Halo_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_wt-mRad21-Halo_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_wt-mRad21-Halo_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';   
        
    elseif DataSet == 11
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_mut-mRad21-Halo_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_mut-mRad21-Halo_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_mut-mRad21-Halo_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_mut-mRad21-Halo_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 12
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_C32_Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                'U2OS_C32_Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                'U2OS_C32_Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_C32_Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 13
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_lipo_wt-Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                'U2OS_lipo_wt-Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                'U2OS_lipo_wt-Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_lipo_wt-Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 14
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_lipo_11ZF-mut-Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                'U2OS_lipo_11ZF-mut-Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                'U2OS_lipo_11ZF-mut-Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_lipo_11ZF-mut-Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 15
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_lipo_ZF-del-Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                'U2OS_lipo_ZF-del-Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                'U2OS_lipo_ZF-del-Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_lipo_ZF-del-Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 16
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_H2B-Halo-SNAP_223Hz_pooled_QC_CD2', ...
                                'U2OS_H2B-Halo-SNAP_133Hz_pooled_QC_CD2',...
                                'U2OS_H2B-Halo-SNAP_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_H2B-Halo-SNAP_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    elseif DataSet == 17
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_Halo-3xNLS_223Hz_pooled_QC_CD2', ...
                                'U2OS_Halo-3xNLS_133Hz_pooled_QC_CD2',...
                                'U2OS_Halo-3xNLS_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_Halo-3xNLS_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';

        
elseif DataSet == 19
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_C3_Halo-Sox2_223Hz_pooled_QC_CD2', ...
                                'mESC_C3_Halo-Sox2_133Hz_pooled_QC_CD2',...
                                'mESC_C3_Halo-Sox2_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_C3_Halo-Sox2_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
        
%%%%%%%%%%%%%%%%%%% MATCHED SIMULATIONS %%%%%%%%%%%%%%%%%%%
elseif DataSet == 20
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_C45_mRad21-Halo_G1_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_C45_mRad21-Halo_G1_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_C45_mRad21-Halo_G1_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_C45_mRad21-Halo_G1_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';

elseif DataSet == 21
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_C45_mRad21-Halo_S-G2_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_C45_mRad21-Halo_S-G2_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_C45_mRad21-Halo_S-G2_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_C45_mRad21-Halo_S-G2_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 22
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_H2B-Halo_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_H2B-Halo_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_H2B-Halo_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_H2B-Halo_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 23
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_Halo-3xNLS_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_Halo-3xNLS_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_Halo-3xNLS_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_Halo-3xNLS_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 24
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 25
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_lipo_11ZF-mut-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_lipo_11ZF-mut-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_lipo_11ZF-mut-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_lipo_11ZF-mut-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 26
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_lipo_mut-mRad21-Halo_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_lipo_mut-mRad21-Halo_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_lipo_mut-mRad21-Halo_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_lipo_mut-mRad21-Halo_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 27
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_lipo_wt-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_lipo_wt-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_lipo_wt-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_lipo_wt-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 28
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_lipo_wt-mRad21-Halo_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_lipo_wt-mRad21-Halo_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_lipo_wt-mRad21-Halo_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_lipo_wt-mRad21-Halo_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 29
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_mESC_lipo_ZF-del-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_mESC_lipo_ZF-del-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_mESC_lipo_ZF-del-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_mESC_lipo_ZF-del-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';

elseif DataSet == 30
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_U2OS_C32_Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_U2OS_C32_Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_U2OS_C32_Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_U2OS_C32_Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 31
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_U2OS_H2B-Halo-SNAP_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_U2OS_H2B-Halo-SNAP_133Hz_pooled_QC_CD2',...
                                '20171023_sim_U2OS_H2B-Halo-SNAP_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_U2OS_H2B-Halo-SNAP_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 32
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_U2OS_Halo-3xNLS_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_U2OS_Halo-3xNLS_133Hz_pooled_QC_CD2',...
                                '20171023_sim_U2OS_Halo-3xNLS_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_U2OS_Halo-3xNLS_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 33
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_U2OS_lipo_11ZF-mut-Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_U2OS_lipo_11ZF-mut-Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_U2OS_lipo_11ZF-mut-Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_U2OS_lipo_11ZF-mut-Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 34
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20171023_sim_U2OS_lipo_wt-Halo-hCTCF_223Hz_pooled_QC_CD2', ...
                                '20171023_sim_U2OS_lipo_wt-Halo-hCTCF_133Hz_pooled_QC_CD2',...
                                '20171023_sim_U2OS_lipo_wt-Halo-hCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = '20171023_sim_U2OS_lipo_wt-Halo-hCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 35
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/AssafSims/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_223Hz', ...
                                'PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_133Hz',...
                                'PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_74Hz'};
        MAT_files.SampleNamePrefix = 'PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_';
        MAT_files.SampleNamesuffix = '';
        SavePath = './HMM_first_QC_data/AssafSims/';
        
elseif DataSet == 36
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/AssafSims/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20180220_PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_223Hz', ...
                                '20180220_PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_133Hz',...
                                '20180220_PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_74Hz'};
        MAT_files.SampleNamePrefix = '20180220_PDF_sphere_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.6_Idist_210_l0_600_';
        MAT_files.SampleNamesuffix = '';
        SavePath = './HMM_first_QC_data/AssafSims/';
        
elseif DataSet == 37
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/AssafSims/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'20180220_PDF_sphere_0TauMin_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.1_Idist_210_l0_600_223Hz', ...
                                '20180220_PDF_sphere_0TauMin_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.1_Idist_210_l0_600_133Hz',...
                                '20180220_PDF_sphere_0TauMin_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.1_Idist_210_l0_600_74Hz'};
        MAT_files.SampleNamePrefix = '20180220_PDF_sphere_0TauMin_A3000_3d_Ch_num2_Ch_lenA200_lenB1_MonTar_10_ch1_1_eps_200_Dtf_5e+06_Tr_0.01_Pre_0.99_PSB_0.1_Idist_210_l0_600_';
        MAT_files.SampleNamesuffix = '';
        SavePath = './HMM_first_QC_data/AssafSims/';
        
        
elseif DataSet == 38
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_RNA-mut-Halo-mCTCF_OneRep_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_RNA-mut-Halo-mCTCF_OneRep_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_RNA-mut-Halo-mCTCF_OneRep_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_RNA-mut-Halo-mCTCF_OneRep_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 39
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_lipo_RNA-mut-Halo-mCTCF_OneRep_74Hz_pooled_QC_CD2', ...
                                'U2OS_lipo_RNA-mut-Halo-mCTCF_OneRep_133Hz_pooled_QC_CD2',...
                                'U2OS_lipo_RNA-mut-Halo-mCTCF_OneRep_223Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_lipo_RNA-mut-Halo-mCTCF_OneRep_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 40
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'mESC_lipo_RNA-mut-Halo-mCTCF_223Hz_pooled_QC_CD2', ...
                                'mESC_lipo_RNA-mut-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'mESC_lipo_RNA-mut-Halo-mCTCF_74Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'mESC_lipo_RNA-mut-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
elseif DataSet == 41
        MAT_files = struct();
        MAT_files.path = './HMM_first_QC_data/';
        MAT_files.Conditions = {'223 Hz', '133 Hz', '74 Hz'};
        MAT_files.workspaces = {'U2OS_lipo_RNA-mut-Halo-mCTCF_74Hz_pooled_QC_CD2', ...
                                'U2OS_lipo_RNA-mut-Halo-mCTCF_133Hz_pooled_QC_CD2',...
                                'U2OS_lipo_RNA-mut-Halo-mCTCF_223Hz_pooled_QC_CD2'};
        MAT_files.SampleNamePrefix = 'U2OS_lipo_RNA-mut-Halo-mCTCF_';
        MAT_files.SampleNamesuffix = '_pooled_QC_CD2_classified';
        
    end

    disp(['Processing DataSet number ', num2str(DataSetIter), ' of 41']);
disp('================================================');
    tic;
    % loop over all of the temporal subsamples to slice out:
    for iter = 1:length(TempSubSampleStruc)
        
        disp(['Proceesing temporal subsample ', num2str(iter), ' of ', num2str(length(TempSubSampleStruc)), ' total']);
        % number of movies sampled:
        MovieNumbCounter = 0;
        % make new placeholder cell arrays
        clear CellTracks CellTrackViterbiClass temp_CellTracks temp_CellTrackViterbiClass 
        temp_CellTracks = cell(1,1);
        temp_CellTrackViterbiClass = cell(1,1);

        % Now go through the 223 Hz, 133 Hz and 74 Hz data one by one:
        for TimeIter = 1:length(TempSubSampleStruc(1,iter).TimePointsToUse)

            % check to see if there were any TimePoints to use:
            if ~isempty(TempSubSampleStruc(1,iter).TimePointsToUse{1,TimeIter})

                % Define temporal subsampling stuff:
                curr_TimePointsToUse_vector = TempSubSampleStruc(1,iter).TimePointsToUse{1,TimeIter};
                
                % Define workspace stuff
                curr_workspaces = MAT_files.workspaces{1,TimeIter};

                % load in each DataSet:           
                load([MAT_files.path, curr_workspaces, '_classified.mat']);
                
                % loop over each TimePointToUse in case there is more than one
                for TP_iter = 1:length(curr_TimePointsToUse_vector)
                    curr_TimePointsToUse = curr_TimePointsToUse_vector(TP_iter);

                    

                    % feed current dataset into the 
                    [ new_CellTracks, new_CellTrackViterbiClass ] = TemporallyReSampleCellTracks(CellTracks, CellTrackViterbiClass, curr_TimePointsToUse);
                    % now update the placeholders:
                    if MovieNumbCounter == 0
                        temp_CellTracks = new_CellTracks;
                        temp_CellTrackViterbiClass = new_CellTrackViterbiClass;
                        MovieNumbCounter = MovieNumbCounter + 1;
                    else
                        % append the new trackedPar (append placeholder cell arrays):
                        temp_CellTracks = horzcat(temp_CellTracks, new_CellTracks);
                        temp_CellTrackViterbiClass = horzcat(temp_CellTrackViterbiClass, new_CellTrackViterbiClass);
                        MovieNumbCounter = MovieNumbCounter + 1;
                    end
                end
            end

        end

        clear CellTracks CellTrackViterbiClass
        CellTracks = temp_CellTracks;
        CellTrackViterbiClass = temp_CellTrackViterbiClass;
        
        % get the LagTime:
        LagTime = InferFrameRateFromName( [MAT_files.SampleNamePrefix, TempSubSampleStruc(1,iter).SumSampleName,  MAT_files.SampleNamesuffix, '.mat']);

        %%%% FINISHED A FULL COLLECTION FOR A NEW FRAME-RATE: SAVE THE DATA %%%
        %   just save all the data to a single trackedPar to avoid having a lot
        %   of files:
        disp(['saving file: ', [MAT_files.SampleNamePrefix, TempSubSampleStruc(1,iter).SumSampleName,  MAT_files.SampleNamesuffix], '...']);
        save([SavePath, MAT_files.SampleNamePrefix, TempSubSampleStruc(1,iter).SumSampleName,  MAT_files.SampleNamesuffix, '.mat'], 'CellTracks', 'CellTrackViterbiClass');
        
    end
    toc;
    disp('================================================');
end



